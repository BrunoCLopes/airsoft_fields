{% extends "organizers/organizer_area/base.html" %} 
{% load static %} 
{% block title %} - Meu Perfil {% endblock %}
{% block script %}
  <script src="{% static 'js/my_profile/profile_photo.js' %}"></script>
  <script src="{% static 'js/forms/form_validation.js' %}"></script>
  <script src="{% static 'js/my_profile/info_update.js' %}"></script>
  <script src="{% static 'js/my_profile/password_update.js' %}"></script>
  <script src="{% static 'js/messages.js' %}"></script>
  <script src="{% static 'js/modal.js' %}"></script>
  <script src="{% static 'js/my_profile/danger_zone.js' %}"></script>
{% endblock %}
{% block content %}
<main class="lg:ml-64 min-h-screen p-4 md:p-8 flex flex-col items-center">
  <header class="mb-8 mt-12 lg:mt-0 w-full max-w-4xl flex justify-between items-center">
    <div>
      <div class="flex items-center gap-3 mb-2">
        <a href="#" class="text-gray-500 hover:text-gray-700 transition-colors">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="size-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18"
            />
          </svg>
        </a>
        <h1 class="text-2xl md:text-3xl font-bold text-gray-800">
          Editar Perfil
        </h1>
      </div>
      <p class="text-gray-600 ml-9">
        Atualize suas informações pessoais e de conta
      </p>
    </div>
    <div>
      {% if messages %}
        {% for message in messages %}
          <div class="flex items-center justify-center">
            <div>
              <div class="flex items-center p-4 pt-2 pb-2 text-sm rounded-lg font-medium message-alert
                {% if message.tags == 'success' %}
                  text-green-800 bg-green-50
                {% elif message.tags == 'error' %}
                  text-red-800 bg-red-50
                {% elif message.tags == 'info' %}
                  text-blue-800 bg-blue-50
                {% endif %}
                " role="alert">
                <svg class="shrink-0 inline w-4 h-4 me-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                  <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                </svg>
                <span class="sr-only">Info</span>
                <div>
                  {{ message }}
                </div>
              </div>
            </div>
          </div>  
        {% endfor %}
      {% endif %}
    </div>
  </header>

  <div class="w-full max-w-4xl space-y-8">
    <form
      id="info-update-form"
      method="POST"
      action="{% url 'info_user_update' %}"
      enctype="multipart/form-data"
      class="bg-white rounded-lg shadow-md border border-gray-200"
    >
    {% csrf_token %}
      <div class="p-6 md:p-8 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="bg-indigo-100 p-2.5 rounded-full">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6 text-indigo-600"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
              />
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-gray-800">
            Informações Pessoais
          </h2>
        </div>
      </div>

      <div class="p-6 md:p-8">
        <div class="form-item mb-8">
          <label class="block text-sm font-semibold text-gray-700 mb-2">
            Foto de Perfil
          </label>

          <div class="flex items-center gap-4">
            <label
              for="profile-photo-input"
              class="relative group cursor-pointer flex-shrink-0"
            >
              <div
                class="w-20 h-20 outline-1 outline-indigo-600 rounded-full bg-indigo-100 flex items-center justify-center text-indigo-600"
              >
                <img src="
                {% if user.profile_photo %} 
                  {{ user.profile_photo.url }} 
                {% else %}
                  {% static 'img/default_photo.svg' %}
                {% endif %}"
                alt="Foto de Perfil"
                id="photo"
                class="{% if user.profile_photo %} w-full h-full {% else %} size-14 {% endif %} rounded-full object-cover">
                <div
                  class="absolute inset-0 rounded-full bg-opacity-0 group-hover:bg-indigo-900/25 flex items-center justify-center transition-all"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="1.5"
                    stroke="currentColor"
                    class="size-6 text-white opacity-0 group-hover:opacity-100 transition-opacity"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      d="m16.862 4.487 1.687-1.688a1.875 1.875 0 1 1 2.652 2.652L10.582 16.07a4.5 4.5 0 0 1-1.897 1.13L6 18l.8-2.685a4.5 4.5 0 0 1 1.13-1.897l8.932-8.931Zm0 0L19.5 7.125M18 14v4.75A2.25 2.25 0 0 1 15.75 21H5.25A2.25 2.25 0 0 1 3 18.75V8.25A2.25 2.25 0 0 1 5.25 6H10"
                    />
                  </svg>
                </div>
              </div>
            </label>

            <div class="flex-1 min-w-0">
              <h3 class="font-semibold text-gray-800 text-xl truncate">
                {{ user.username }}
              </h3>
              <span
                class="inline-block px-2 py-0.5 text-lg font-medium bg-indigo-100 text-indigo-700 rounded-full mt-1"
              >
                Organizador
              </span>
            </div>
          </div>

          <button
            type="button"
            id="remove-photo"
            class="mt-2 text-sm text-red-600 hover:text-red-800 hover:cursor-pointer font-semibold block"
          >
            Remover imagem
          </button>
          <input type="hidden" id="default-photo" name="default-photo" value="False" />
          <input
            id="profile-photo-input"
            name="profile-photo"
            type="file"
            accept="image/*"
            class="sr-only"
          />
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-item md:col-span-2">
            <label
              for="username"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Nome de Usuário
            </label>
            <input
              type="text"
              id="username"
              name="username"
              class="required w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="Informe um nome de usuário"
              value="{{ user.username }}"
            />
          </div>

          <div class="form-item">
            <label
              for="email"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Email
            </label>
            <input
              type="email"
              id="email"
              name="user-email"
              class="required w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="exemplo@email.com"
              value="{{ user.email }}"
            />
          </div>

          <div class="form-item">
            <label
              for="phone"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Telefone
            </label>
            <input
              type="tel"
              id="phone"
              name="user-phone"
              class="field-phone w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="(XX) XXXXX-XXXX"
              value="{% if user.phone %}{{ user.phone }}{% endif %}"
            />
          </div>
        </div>
      </div>

      <div
        class="flex justify-end gap-4 p-6 bg-white border-t border-gray-200 rounded-b-lg"
      >
        <button
          type="submit"
          class="flex-1 sm:flex-none px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 hover:cursor-pointer transition-colors"
        >
          Salvar Alterações
        </button>
      </div>
    </form>

    <form
      id="password-update-form"
      method="POST"
      action="{% url 'security_user_update' %}"
      class="bg-white rounded-lg shadow-md border border-gray-200"
    >
    {% csrf_token %}
      <div class="p-6 md:p-8 border-b border-gray-200">
        <div class="flex items-center gap-3">
          <div class="bg-indigo-100 p-2.5 rounded-full">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6 text-indigo-600"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M16.5 10.5V6.75a4.5 4.5 0 1 0-9 0v3.75m-.75 11.25h10.5a2.25 2.25 0 0 0 2.25-2.25v-6.75a2.25 2.25 0 0 0-2.25-2.25H6.75a2.25 2.25 0 0 0-2.25 2.25v6.75a2.25 2.25 0 0 0 2.25 2.25Z"
              />
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-semibold text-gray-800">Alterar Senha</h2>
            <p class="text-gray-600 text-sm mt-1">
              Para sua segurança, escolha uma senha forte.
            </p>
          </div>
        </div>
      </div>

      <div class="p-6 md:p-8">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="form-item md:col-span-2">
            <label
              for="old-password"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Senha Atual
            </label>
            <input
              type="password"
              id="old-password"
              name="old-password"
              class="required w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="Sua senha atual"
            />
          </div>

          <div class="form-item">
            <label
              for="new-password"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Nova Senha
            </label>
            <input
              type="password"
              id="new-password"
              name="new-password"
              class="required w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="Mínimo 8 caracteres"
            />
          </div>

          <div class="form-item">
            <label
              for="confirm-new-password"
              class="block text-sm font-semibold text-gray-700 mb-2"
            >
              Confirmar Nova Senha
            </label>
            <input
              type="password"
              id="confirm-new-password"
              name="confirm-new-password"
              class="w-full px-4 py-2.5 outline outline-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"
              placeholder="Repita a nova senha"
            />
          </div>
        </div>
      </div>

      <div
        class="flex justify-end gap-4 p-6 bg-white border-t border-gray-200 rounded-b-lg"
      >
        <button
          type="submit"
          class="flex-1 sm:flex-none px-6 py-3 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 hover:cursor-pointer transition-colors"
        >
          Atualizar Senha
        </button>
      </div>
    </form>

    <div class="bg-white rounded-lg shadow-md border border-red-300">
      <div class="p-6 md:p-8 border-b border-red-200">
        <div class="flex items-center gap-3">
          <div class="bg-red-100 p-2.5 rounded-full">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-6 text-red-600"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"
              />
            </svg>
          </div>
          <h2 class="text-xl font-semibold text-red-700">Zona de Perigo</h2>
        </div>
      </div>

      <div
        class="p-6 md:p-8 space-y-4 md:flex md:items-center md:justify-between md:space-y-0"
      >
        <div>
          <h3 class="text-lg font-semibold text-gray-800">Deleção de Conta</h3>
          <p class="text-gray-600 text-sm mt-1 max-w-xl">
            Esta ação não pode ser desfeita. Todos os seus dados serão
            permanentemente removidos.
          </p>
        </div>
        <button
          id="delete-account-button"
          type="button"
          class="px-6 py-3 bg-red-600 text-white font-semibold rounded-lg hover:bg-red-700 hover:cursor-pointer transition-colors flex-shrink-0"
        >
          Deletar Minha Conta
        </button>
      </div>
    </div>
  </div>
</main>

<div id="delete-account-modal" class="modal-bg close-modal hidden fixed inset-0 bg-gray-900/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
      <!-- Header -->
      <div class="p-4 sm:p-6 border-b border-gray-200">
        <div class="flex items-start gap-3">
          <div class="bg-red-100 p-2 sm:p-3 rounded-full shrink-0">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5 sm:size-6 text-red-600">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />
            </svg>
          </div>
          <div class="flex-1 min-w-0">
            <h3 class="text-base sm:text-lg font-semibold text-gray-900">Confirmar Exclusão da Conta</h3>
            <p class="text-xs sm:text-sm text-gray-500">Esta ação não pode ser desfeita</p>
          </div>
        </div>
      </div>

      <!-- Body -->
      <div class="p-4 sm:p-6">
        <p class="text-sm sm:text-base text-gray-700 mb-2">Tem certeza de que deseja excluir sua conta?</p>
        <p class="text-xs sm:text-sm text-gray-500">Todas as fotos e informações associadas à sua conta serão permanentemente removidas.</p>
      </div>

      <!-- Footer -->
      <div class="p-4 sm:p-6 border-t border-gray-200 flex flex-col-reverse sm:flex-row gap-2 sm:gap-3 sm:justify-end">
        <form method="POST" action="{% url 'delete_user' %}">
          {% csrf_token %}
          <button
          type="button"
            class="close-modal w-full sm:w-auto px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-100 hover:cursor-pointer transition-colors font-medium text-sm"
          >
            Cancelar
          </button>
          <button
            type="submit"
            class="w-full sm:w-auto px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 hover:cursor-pointer transition-colors font-medium text-sm"
          >
            Excluir
          </button>
        </form>
      </div>
    </div>
  </div>
{% endblock %}
